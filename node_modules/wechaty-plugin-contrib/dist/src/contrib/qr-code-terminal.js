"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.QRCodeTerminal = void 0;
/**
 * Author: Huan LI https://github.com/huan
 * Date: Apr 2020
 */
const wechaty_1 = require("wechaty");
const qrcode_terminal_1 = require("qrcode-terminal");
function QRCodeTerminal(config = {
    small: false,
}) {
    wechaty_1.log.verbose('WechatyPluginContrib', 'QRCodeTerminal("%s")', JSON.stringify(config));
    return function QRCodeTerminalPlugin(wechaty) {
        wechaty_1.log.verbose('WechatyPluginContrib', 'QRCodeTerminal installing on %s ...', wechaty);
        wechaty.on('scan', function onScan(qrcode, status) {
            if (status === wechaty_1.ScanStatus.Waiting || status === wechaty_1.ScanStatus.Timeout) {
                qrcode_terminal_1.generate(qrcode, {
                    small: config.small,
                });
                /**
                 * Wechaty QR Code Image Generator:
                 *  https://github.com/wechaty/qrcode
                 */
                const qrcodeImageUrl = [
                    'https://wechaty.github.io/qrcode/',
                    encodeURIComponent(qrcode),
                ].join('');
                wechaty_1.log.info('WechatyPluginContrib', 'QRCodeTerminal Login QR Code Status: %s(%s)\nQR Code Image URL: %s', wechaty_1.ScanStatus[status], status, qrcodeImageUrl);
            }
            else {
                wechaty_1.log.info('WechatyPluginContrib', 'QRCodeTerminal onScan: %s(%s)', wechaty_1.ScanStatus[status], status);
            }
        });
    };
}
exports.QRCodeTerminal = QRCodeTerminal;
//# sourceMappingURL=qr-code-terminal.js.map