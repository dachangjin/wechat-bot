#!/usr/bin/env ts-node
"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const tstest_1 = __importDefault(require("tstest"));
const room_matcher_1 = require("./room-matcher");
tstest_1.default('roomMatcher() smoke testing', (t) => __awaiter(void 0, void 0, void 0, function* () {
    const matcher = room_matcher_1.roomMatcher(/test/i);
    t.equal(typeof matcher, 'function', 'should return a match function');
}));
tstest_1.default('roomMatcher() with string option', (t) => __awaiter(void 0, void 0, void 0, function* () {
    const TEXT_OK = 'hello';
    const TEXT_NOT_OK = 'world';
    const topicOk = () => TEXT_OK;
    const topicNotOk = () => TEXT_NOT_OK;
    const roomIdOk = {
        id: TEXT_OK,
        topic: topicNotOk,
    };
    const roomTopicOk = {
        id: TEXT_NOT_OK,
        topic: topicOk,
    };
    const roomNotOk = {
        id: TEXT_NOT_OK,
        topic: topicNotOk,
    };
    const falseMatcher = room_matcher_1.roomMatcher();
    t.false(yield falseMatcher(roomIdOk), 'should not match any room without options');
    t.false(yield falseMatcher(roomTopicOk), 'should not match any room without options');
    const idMatcher = room_matcher_1.roomMatcher(TEXT_OK);
    t.false(yield idMatcher(roomNotOk), 'should not match unexpected room by id');
    t.true(yield idMatcher(roomIdOk), 'should match expected room by id');
    t.false(yield idMatcher(roomTopicOk), 'should not match room by topic');
    const idListMatcher = room_matcher_1.roomMatcher([TEXT_OK]);
    t.false(yield idListMatcher(roomNotOk), 'should not match unexpected room by id list');
    t.true(yield idListMatcher(roomIdOk), 'should match expected room by id list');
    t.false(yield idListMatcher(roomTopicOk), 'should not match room by topic list');
    const regexpMatcher = room_matcher_1.roomMatcher(new RegExp(TEXT_OK));
    t.false(yield regexpMatcher(roomNotOk), 'should not match unexpected room by regexp');
    t.false(yield regexpMatcher(roomIdOk), 'should match room id by regexp');
    t.true(yield regexpMatcher(roomTopicOk), 'should match expected room topic by regexp');
    const regexpListMatcher = room_matcher_1.roomMatcher([new RegExp(TEXT_OK)]);
    t.false(yield regexpListMatcher(roomNotOk), 'should not match unexpected room by regexp list');
    t.false(yield regexpListMatcher(roomIdOk), 'should not match room id by regexp list');
    t.true(yield regexpListMatcher(roomTopicOk), 'should match expected room topic by regexp list');
    const roomFilter = (room) => [
        room.id,
        room.topic(),
    ].includes(TEXT_OK);
    const functionMatcher = room_matcher_1.roomMatcher(roomFilter);
    t.false(yield functionMatcher(roomNotOk), 'should not match unexpected room by function');
    t.true(yield functionMatcher(roomTopicOk), 'should match expected topic by function');
    t.true(yield functionMatcher(roomIdOk), 'should match expected id by function');
    const functionListMatcher = room_matcher_1.roomMatcher([roomFilter]);
    t.false(yield functionListMatcher(roomNotOk), 'should not match unexpected room by function list');
    t.true(yield functionListMatcher(roomTopicOk), 'should match expected topic by function list');
    t.true(yield functionListMatcher(roomIdOk), 'should match expected text by function list');
}));
//# sourceMappingURL=room-matcher.spec.js.map